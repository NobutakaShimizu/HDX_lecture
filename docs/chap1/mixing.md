---
title: ランダムウォークの収束性
nav_order: 2
parent: ランダムウォーク概論
---
# ランダムウォークの収束性

ランダムウォーク$(X_t)_{t\ge 0}$を考え, 時刻$t$における$X_t$の周辺分布を$p_t$とする. すなわち, $p_t \in [0,1]^V$は$p_t(v) = \Pr\qty[X_t = v]$で定義されるベクトルである. 本講義では総じて時刻$t$を大きくしていくときの$p_t$の収束性とそのスピードについて議論していく.

まずは収束性について議論するために分布間の距離として全変動距離を導入する.

{: .definition-title }
> **定義1.2.1(全変動距離)**
>
>有限集合$V$上の二つの分布$\mu,\nu \in[0,1]^V$に対し, **全変動距離 (total variation distance)**を
>
> $$
\dtv (\mu ,\nu ) \defeq \frac{1}{2} \sum_{u\in V}\abs{\mu(u) - \nu(u)} = \frac{1}{2} \norm{\mu - \nu}_1
> $$
>
> で定める.

全変動距離は単に$\ell^1$ノルムを$2$で割った値だが, 次の性質を持つがゆえに統計学, 情報理論, 機械学習, 計算機科学を含む様々な分野で非常に重要な役割を果たしている.

{: .proposition-title }
> **命題1.2.2(全変動距離の性質)**
>
> 有限集合$V$を考え, 分布$\pi\in[0,1]^V$と部分集合$U\subseteq V$に対し$\pi(U)\defeq\sum_{u\in U}\pi(u)$とする. 任意の二つの分布$\mu,\nu\in[0,1]^V$と任意の部分集合$U\subseteq Vに対して
>
> $$
\abs{ \mu(U) - \nu(U) } \le \dtv(\mu,\nu)
> $$

すなわち, 全変動距離が小さいということは任意の事象の発生確率の差が小さいことを意味する. なお, この不等式はタイトである. 実際, $U=\qty{ u\in V \colon \mu(u) > \nu(u) }$とすれば等号が成り立つ.

次に, ランダムウォークが収束するための条件を与える.

## 既約性, 非周期性

{: .definition-title }
> **定義1.2.3(既約性, 非周期性)**
>
> 遷移確率行列$P \in [0,1]^{V\times V}$をもつランダムウォークを考える.
> 
> - 任意の頂点対$u,v\in V$に対しある$t \ge 0$が存在して$P^t(u,v)>0$を満たすとき, ランダムウォーク$(X_t)_{t\ge 0}$は**既約 (irreducible)**であるという.
> - 各頂点$u\in V$に対し, 有向閉路長の集合$L_u = \qty{ t \ge 1 \colon P^t(u,u) > 0}$を考え, その最大公約数を頂点$u$の**周期 (period)** と呼ぶ. 全ての頂点の周期が$1$であるとき, ランダムウォーク$(X_t)_{t\ge 0}$は**非周期的 (aperiodic)**であるという.

既約性は任意の頂点対$u,v$に対し$u$からスタートしたランダムウォークが$v$に到達可能であることを意味している.
非周期性は, ランダムウォークが「振動」しないことを意味する性質である. 例えば遷移確率行列が

$$
P = \begin{bmatrix}
0 & 1 & 0 \\
0 & 0 & 1 \\
1 & 0 & 0
\end{bmatrix}
$$

で与えられるランダムウォークは全ての有向閉路の長さは$3$の倍数であるためどの頂点の周期も$3$に等しい. 特に, ランダムウォーク$X_t$は周期$3$でループしており, 例えば確率$1$で特定の頂点からスタートしたときに$p_t$は収束しないことがわかる. 非周期性はこのようなケースを排除するという意味を持つ.

## 定常分布

ランダムウォークの分布$p_t$がある分布$\pi\in[0,1]^V$に収束するならば, 分布の漸化式$p_t = p_{t-1}P$より収束先の分布$\pi$は

$$
\pi = \pi P \label{eq:stationary equation}
$$

を満たすはずである.

{: .definition-title }
> **定義1.2.4(定常分布)**
>
>遷移確率行列$P$をもつ$V$上のランダムウォークに対し, \cref{eq:stationary equation}を満たす分布$\pi$を**定常分布 (stationary distribution)**と呼ぶ.

任意のランダムウォークは必ず定常分布をもつ.(有限集合上の分布を考えているので)分布全体から分布全体への連続関数$x \mapsto xP$に対しブラウアーの不動点定理を適用すればすぐに示せる.

{: .theorem-title }
> **定理1.2.5(ブラウアーの不動点定理)**
>
> Euclid空間の非空なコンパクト凸部分集合$K$からそれ自身への任意の連続関数は不動点をもつ.

また, 詳細は省くがこれは以下の議論からも証明できる:

- 定常分布$\pi$は転置行列$P^{\top}$の固有値$1$の固有ベクトルに対応する.
- $P$と$P^\top$の固有値は全て同じ (転置をとっても行列式は変わらないから)であり, 最大固有値$1$を持つ.
- Perron--Frobeniusの定理から$P^\top$の最大固有値$1$に対応する固有ベクトルの成分は非負なので, 正規化すると分布になる.

以下にランダムウォークの収束性を証明する.

<div id="thm:random walk convergence" markdown="1">
{: .theorem-title }
> **定理1.2.6(ランダムウォークの収束性)**
>
> 遷移確率行列$P$を持つ$V$上の任意のランダムウォークは定常分布$\pi \in [0,1]^V$を持つ. さらに,
>
> - ランダムウォークが既約的ならば, 定常分布$\pi$は一意に存在し, 全ての頂点$v\in V$に対し$\pi(v)>0$である.
> - ランダムウォークが既約的かつ非周期的ならば, 定常分布$\pi$が一意に存在して$\dtv(p_t,\pi)\to 0$ ($t\to\infty$)が成り立つ.
</div>

[定理1.2.6](#thm:random walk convergence)は一つ目の主張は定常分布の定義を使えば簡単に示せるが二つ目の主張の証明は難しい. そのためにまず, 以下の三つの補題を証明する.

<div id="lem:Schur lemma" markdown="1">
{: .lemma-title }
> **補題1.2.7: Shurの補題**
>
> $S\subseteq \Nat$が$\gcd(S)=1$ならば, ある$N\in\Nat$が存在して任意の自然数$M\ge N$は$S$の要素の非負結合で表せる.
</div>
<details markdown="1" style="background-color: #eee;">
<summary style="display: list-item">証明</summary>
  
一般性を失わず$S$は有限集合としてよい. 実際, $S_n = S \cap \set{1,\dots,n\}$とすると$\gcd(S_n)$は$n$を大きくしていくにつれて減少していくが, 減少する回数は有限回なので, 十分大きな$n$に対して$\gcd(S_n)=1$となる. このとき, $S$の代わりに$S_n$を考えればよい.

簡単のため$\abs{S}=3$で証明する (一般の$S$の場合も同様に証明できる). $S=\set{a,b,c}$とすると, $\gcd(a,b,c)=1$より, 任意の$M\in\Nat$に対しある整数$x,y,z\in \Int$が存在して$ax+by+cz=M$を満たす. このような$x,y,z$は一意ではなく, $i+j+k=0$を満たす任意の$i,j,k\in\Int$に対して

$$
a(x+ibc) + b(y+jac) + c(z+kab) = M
$$

である. ここで, $i,j\in\Int$は任意に決めてよいので, $0\le x+ibc < bc, 0\le y+jac < ac$とできる. このときもしも$M\ge 2abc$ならば

$$
c(z+kab) = M - a(x+ibc) - b(y+jac) > M - 2abc \ge 0
$$

なので, $z+kab \ge 0$であり, 確かに$M$は$a,b,c$の非負結合で表せた.

</details>

<div id="lem:P bekijou" markdown="1">
{: .lemma-title }
> **補題1.2.8**
>
> 任意の既約的かつ非周期的なランダムウォークの遷移確率行列$P$に対し, ある整数$L \ge 1$が存在して, $P^L$の全ての成分は正となる.
</div>

<details markdown="1" style="background-color: #eee;">
<summary style="display: list-item">証明</summary>
  遷移確率行列 $P$ に対し有向グラフ $\vG=(V,\vec{E})$ を, $P(u,v)>0$ のときかつその時に限り有向辺 $(u,v)$ を追加して得られる有向グラフとする.$P^L(u,v)$ は, $u$ から開始したランダムウォークがちょうど $L$ 回の遷移の後に $v$ にいる確率である.この値が正であるということは, $\vG$ 上で $u$ から $v$ への長さちょうど $L$ の有向路が存在することを意味する.

  頂点 $w\in V$ を任意に固定し, $S\subseteq \Nat$ を $S = \set{i\ge 0\colon P^i(w,w)>0}$ とする.非周期性より $\gcd(S)=1$ である.この集合 $S$ に対し[補題1.2.7](#lem:Schur lemma)により存在性が保証される自然数 $N\in\Nat$ を考える.すると, 任意の $M\ge N$ に対して $\vG$ は $w$ を通る長さ $M$ の有向閉路をもつ (つまり $P^M(w,w)>0$).

  $L=2|V|+N$ が主張を満たすことを示す.すなわち, 任意の $u,v\in V$ に対し, $\vG$ は $u$ から $v$ への長さ $L$ の有向路を含むことを示す.既約性の仮定より $\vG$ は途中で $w$ を経由する長さ $\ell \le 2|V|$ の $uv$-有向路 $p$ を持つ.この有向路 $p$ に沿って $u$ から $w$ に進み, そこから長さ $L - \ell \ge N$ の閉路に沿って進み, さらに再び $p$ に沿って $w$ から $v$ に進む有向路を考えると, その長さはちょうど $L$ であり, すなわち $P^L(u,v)>0$ を意味する.
</details>
<div id="lem:ellone norm" markdown="1">
{: .lemma-title }
> **補題1.2.9**
>
> 任意の確率行列$P\in[0,1]^{V\times V}$とベクトル$x\in\Real^V$に対し,
> $$\norm{xP}_{1} \le \norm{x}_{1}$$.
</div>

<details markdown="1" style="background-color: #eee;">
<summary style="display: list-item">証明</summary>
  任意の$u\in V$に対し

  $$
  \begin{align*}
    \norm{xP}_1 &= \sum_{u\in V} \abs{(xP)(u)} \\
    &= \sum_{u\in V} \abs{ \sum_{v\in V} x(v) P(v,u) } \\
    &\le \sum_{u,v\in V}\abs{x(v)}\cdot P(v,u) \\
    &= \sum_{v\in V}\abs{x(v)}\cdot \sum_{u\in V}P(v,u) \\
    &= \norm{x}_1.
  \end{align*}
  $$

</details>

これら三つの補題を用いて[定理1.2.6](#thm:random walk convergence)の証明を与える.

<details markdown="1" style="background-color: #eee;">
<summary style="display: list-item">定理1.2.6の証明</summary>

一つ目の主張を示す.
$P$が既約として, 定常分布の一つを$\pi \in [0,1]^V$とし,
ある頂点$u\in V$に対し$\pi(u)=0$が成り立つとする.
$\pi$は分布なのである$v\in V$に対し$\pi(v)>0$となる.
既約性より, この$v$に対してある$\ell\in\Nat$が存在して$P^\ell(u,v)>0$となる.
$\pi =\pi P^\ell$より,

$$
  0 = \pi(u) = \sum_{w\in V}\pi(w)P^\ell(w,u) \ge \pi(v)P^\ell(v,u)>0
$$

となり矛盾を得る.

二つ目の主張を示す.$P$は非周期的なので
[補題1.2.8](#lem:P bekijou)より, ある$L\ge 1$に対して$Q\defeq P^L$の全ての成分は正である.従って, ある$0<\delta<1$, 全成分が$1/\abs{V}$の確率行列$J$, 適当な確率行列$R$を用いて

$$
Q = \delta J + (1-\delta)R
$$

と表せる.まず定常分布の一意性を示す.二つの相異なる定常分布$\pi,\pi'$が存在すると仮定すると

$$
\norm{\pi - \pi'}_1 = \norm{\pi Q -  \pi' Q}_1 = (1-\delta)\norm{(\pi - \pi')R}_1 \le  (1-\delta)\norm{\pi - \pi'}_1
$$

となる.
ここで, 最後の不等号で[補題1.2.9](#lem:ellone norm)を用いた.
これは$\norm{\pi - \pi'}_1>0$に矛盾する.以上より一意性が示された.

次に収束性を示す.$\allone$に直交する任意のベクトルに対し$xQ^t$を考える.まず, $t=1$のときは$xQ = (1-\delta) xR$となり, このベクトルもまた$\allone$に直交している.実際, $\inprod{xR,\allone} = x^\top R \allone = x^\top \allone = 0$である.このことから$t=2$のときは$xQ^2 = (1-\delta)xR \cdot (\delta J + (1-\delta) R) =(1-\delta)^2 xR^2$を得る.これを繰り返していくと, 一般の$t$に対して$xQ^t = (1-\delta)^txR^t$を得る.初期分布$p_0\in[0,1]^V$に対し, $x\defeq p_0 - \pi$は$\allone$に直交するので

$$
\begin{align*}
\norm{p_t - \pi}_{1} &= \norm{(p_0-\pi)P^t}_{1} \\
&\le \norm{xQ^{\floor{t/L}}}_{1} & & \text{$\because$補題1.2.9}\\
&= (1-\delta)^{\floor{t/L}}\cdot \norm{x R^{\floor{t/L}}}_1 \\
& \le (1-\delta)^{\floor{t/L}} \norm{x}_{1} & & \text{$\because$補題1.2.9} \\
& \to 0
\end{align*}
$$

を得る.
よって, 確かにランダムウォークの分布$(p_t)$は定常分布$\pi$に収束する.

</details>

## 混交時間

[定理1.2.6](#thm:random walk convergence)ではランダムウォークの一意収束性の条件を与えた. では, その収束の速さはどれくらいだろうか? この問題は日常的には例えば次のような状況で現れる:

- トランプカードで遊ぶとき, 何回シャッフルすればカードが「混ざり合う」か?
- 料理で調味料をスープに入れたとき, 何回かき回せば味が「混ざり合う」か?

ここでは「混ざり合う」とは定常分布への全変動距離の意味での収束性で定義し, ランダムウォークの混交時間を次で定義する:

{: .definition-title }
> **定義1.2.10: 混交時間**
>
> 既約なランダムウォーク$(X_t)_{t\ge 0}$を考え, $t\ge 0$に対し$p_t \in [0,1]^V$を時刻$t$における$X_t$の分布とする. 定常分布を$\pi \in [0,1]^V$とする. 正の実数$\varepsilon > 0$に対し, $\varepsilon$-混交時間$\tmix(\varepsilon)$を
>
> $$
\tmix(\varepsilon) \defeq \inf\qty{ t \ge 0 \colon \dtv(p_t, \pi) \le \varepsilon}
> $$
>
> とする. また, $(1/2)$-混交時間を単に**混交時間 (mixing time)**と呼ぶ. なお, この定義において$1/2$という数字に特に本質的な意味はない.

{: .remark-title }
> **備考: 混交時間の定義**
>
> ランダムウォークの混交時間はその初期分布に依存する. 例えば初期分布が定常分布$\pi$であった場合, 混交時間は$0$である. 基本的には任意の初期分布を考え, その中で混交時間の最大値を考える. 任意の分布はディラック測度の凸結合で表せるため, 全ての初期分布での最大を考える代わりに, 各ディラック測度(確率$1$で特定の頂点を選択する測度)に関する最大値だけ考えればよい. すなわち, 本講義で初期分布を指定していないランダムウォークに対して混交時間の上界を議論する際は
>
> $$
\max_{u\in U} \inf\qty{ t\ge 0 \colon \dtv(P^t(u,\cdot),\pi) \le \varepsilon }
> $$
>
> を上から抑えることを意味する.

本講義では全体を通じてランダムウォークの混交時間(特にその上界)を評価することに取り組む. 中でも特に強力な固有値に基づく解析について説明し, これに基づいてグラフや単体複体のエクスパンダー性を定義し, その性質を解説していく. 最後にマトロイドと呼ばれる重要な離散構造上のランダムウォークを解析し, 重要な未解決問題であり近年ようやく解決されたMihail--Vazirani予想の証明を与える.
