---
title: ランダムウォークの固有値と可逆性
nav_order: 4
parent: ランダムウォーク概論
---

# ランダムウォークの固有値と可逆性

遷移確率行列 $P \in [0,1]^{V \times V}$ に従う $V$ 上の既約的かつ非周期的なランダムウォーク $(X_t)_{t\ge 0}$ を考え、その一意な定常分布を $\pi$ とする。[定理1.2.6]({{site.baseurl}}/docs/chap1/mixing#thm:random walk convergence) より収束性が保証されるが、その速さを遷移確率行列の固有値に基づいて評価できる。

遷移確率行列 $P \in [0,1]^{n \times n}$ の固有値[^1]
$\lambda_1,\dots,\lambda_n$ について考える。全ての成分が $1$ であるベクトル $\allone\in \Real^n$ を考えると $P\allone = \allone$ であるから $P$ は固有値 $1$ を持つ。さらに、以下が成り立つ:

[^1]: 本講義では左固有値、すなわち $Px=\lambda x$ を満たす $\lambda\in \Comp$ を考える。

{: .theorem-title }
> **定理1.4.1(遷移確率行列の固有値)**
>
> 任意の遷移確率行列 $P\in [0,1]^{n\times n}$ の固有値 $\lambda_1,\dots,\lambda_n$ に対して $\abs{\lambda_i}\le 1$ が成り立つ。
>
> さらに、$P$ が既約的かつ非周期的なランダムウォークの遷移確率行列とすると、固有値 $1$ の多重度は $1$ であり、他の固有値は全て絶対値が真に $1$ より小さい。

<details markdown="1" style="background-color: #eee;">
<summary style="display: list-item">証明</summary>
  
まず一つ目の主張を示す。$P$ の任意の固有値 $\lambda \in \Comp$ を考え、対応する固有ベクトルを $f \in \Comp^V$ とする。頂点 $u\in V$ を、$\abs{f(u)}$ が最大となる頂点とすると

$$
\abs{\lambda} \abs{f(u)} = \abs{(Pf)(u)} \le \sum_{v\in V} P(u,v) \abs{f(v)} \le \abs{f(u)}\cdot \sum_{v\in V} P(u,v) = \abs{f(u)}
$$

より、両辺を $\abs{f(u)}>0$ で割ると $\abs{\lambda}\le 1$ を得る。

二つ目の主張を示す。$P$ を既約的かつ非周期的なランダムウォークの遷移確率行列とする。$J\in\Real^{V\times V}$ を全成分が $1/n$ の行列とする。ある $L\in\Nat,\delta\in (0,1)$ および確率行列 $R\in[0,1]^{V\times V}$ が存在して、$Q\defeq P^L$ は

$$
Q = \delta J + (1 - \delta) R
$$

と表せる (ここで $J$ は全成分が $1/\abs{V}$ の確率行列)。$f\in \Comp^V$ を $P$ の第一以外の任意の固有値 $\lambda$ に対する固有ベクトルとする。すなわち、$f$ は何らかの定数 $c\in\Comp$ に対し **$f=c\allone$** の形になって**いない**固有ベクトルである。二頂点 $u,v\in V$ を $\abs{f(u) - f(v)}$ が最大となるようにとる。$f$ の取り方の仮定から $\abs{f(u) - f(v)} > 0$ である。すると、$f$ は $Q$ の固有値 $\lambda^L$ に対応する固有ベクトルなので

$$
\begin{align*}
\abs{\lambda^L}\abs{f(u) - f(v)} &= \abs{(Qf)(u) - (Qf)(v)} \\
&= (1-\delta)\abs{(Rf)(u) - (Rf)(v)} \\
&\le (1-\delta)\max_{w,w'\in V}\abs{f(w) - f(w')}
\end{align*}
$$

より、両辺を $\abs{f(u) - f(v)} > 0$ で割って整理すれば $\abs{\lambda^L}<1$ を得る。
</details>

ランダムウォークの固有値の議論の土台となるのが**可逆性**という概念である。一般の遷移確率行列は対称とは限らないが、**可逆性**を仮定することによって遷移確率行列を対称行列として扱うことができ、対称行列に対して展開される固有値分解などの理論を同じように遷移確率行列に対しても適用することができる。

{: .definition-title }
> **定義1.4.2(可逆性)**
>
> 遷移確率行列 $P$ を持つ $V$ 上のランダムウォークは、ある $V$ 上の分布 $\pi \in [0,1]^V$ が存在して
>
> $$
\forall u,v\in V,\pi(u) P(u,v) = \pi(v) P(v,u)
> $$
>
> を満たすとき**可逆 (reversible)**であるという。

この条件を**詳細釣り合い条件 (detailed balanced equation)**という。分布 $\pi\in [0,1]^V$ を対角成分に並べた対角行列 $\Pi\in[0,1]^{V\times V}$ を用いると

$$
\Pi P = (\Pi P)^{\top}
$$

となる。

**可逆性**とは直感的に言うと、逆再生しても同じ分布のランダムウォークになるという性質である。ランダムウォーク $(X_t)_{t\ge 0}$ であって初期頂点 $X_0$ が分布 $\pi$ に従って選ばれたものを考えよう。適当な時刻 $t=T$ で打ち切って得られる頂点列 $(X_0,\dots,X_T)$ に対し、順序を逆にした系列 $(X_T,\dots,X_0)$ はランダムウォークから得られた系列と見做せるだろうか? 仮にこれがある遷移確率行列 $P^*\in[0,1]^{V\times V}$ に従うランダムウォークであったとしよう。簡単のため $T=1$ とする ($T\ge 2$ に関しても同じ議論が適用できる)。初期頂点 $X_0$ の分布 $\pi$ が定常分布だとすると、$X_1$ の分布も $\pi$ である。また、ランダムウォークの条件から $\Pr[X_1 = v \tand X_0=u] = \pi(u)P(u,v)$ である。従って条件付き確率の定義より

$$
P^*(v,u) = \Pr[X_0 = u | X_1 = v] = \frac{\Pr[X_0 = u \tand X_1 = v]}{\Pr[X_1 = v]} = \frac{\pi(u)P(u,v)}{\pi(v)}
$$

が得られる。もし元のランダムウォークが**可逆**ならば、$P^*=P$ を得る。すなわち、ランダムウォークの**可逆性**とはそのランダムウォークが時間反転に関して対称性を持つことを意味する。なお、この遷移確率行列に従って生成されるランダムウォークを**時間反転ランダムウォーク (time-reversal random walk)**と呼ぶ。

なお、後の節で**可逆**なランダムウォークに対する定理「遷移確率行列の固有値」を証明する。

#### 例1. 単純ランダムウォーク

連結グラフ $G=(V,E)$ 上の**単純ランダムウォーク**を考えよう。定常分布を $\pi$ とすると任意の二頂点 $u,v\in V$ に対して

$$
\pi(u) P(u,v) = \frac{\deg(u)}{2|E|} \cdot \frac{\indicator{\{u,v\}\in E}}{\deg(u)} = \frac{\deg(v)}{2|E|} \cdot \frac{\indicator{\{u,v\}\in E}}{\deg(v)} = \pi(v) P(v,u)
$$

より、**単純ランダムウォーク**は**可逆**である (連結なので全ての頂点に対して $\deg(u)>0$ である)。ここで、$\indicator{\dots}$ は指示関数である。同様に、**重み付きランダムウォーク**もまた**可逆**である。

#### 例2. 有向グラフ上のランダムウォーク

可逆で**ない**例として次の遷移確率行列で与えられるランダムウォークを考えてみよう:

$$
P = \begin{pmatrix}
0 & 1 & 0 \\
0 & 0 & 1 \\
1 & 0 & 0
\end{pmatrix}
$$

この例は遷移が決定的なのでランダムウォークとしては面白くないが、次のようにして**可逆**でないことが確認できる: 頂点集合を $V=\{0,1,2\}$ とし、$i\in V$ に対して $(i+1)\bmod 3$ を省略して $i+1 \in V$ と書くと

$$
\pi(i) = \pi(i) P(i, i+1) = \pi(i+1)P(i+1,i) = 0
$$

より $\pi=0$ となってしまい、分布であることに矛盾。
